<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Le Biographe - Assistant IA</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --accent-color: #e74c3c;
            --light-bg: #f8f9fa;
            --dark-bg: #343a40;
            --text-color: #333;
            --light-text: #f8f9fa;
            --border-radius: 8px;
            --box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #e4e8eb 100%);
            color: var(--text-color);
            line-height: 1.6;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1000px;
            margin: 30px auto;
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            overflow: hidden;
        }
        
        header {
            background: var(--primary-color);
            color: var(--light-text);
            padding: 25px 30px;
            border-bottom: 3px solid var(--secondary-color);
            text-align: center;
        }
        
        header h1 {
            font-size: 2.2rem;
            margin-bottom: 5px;
            font-weight: 600;
        }
        
        header p {
            font-size: 1.1rem;
            opacity: 0.9;
            max-width: 700px;
            margin: 0 auto;
        }
        
        .chat-container {
            padding: 20px;
            background-color: white;
        }
        
        .iframe-container {
            position: relative;
            height: 550px;
            background: var(--light-bg);
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: inset 0 2px 6px rgba(0, 0, 0, 0.05);
        }
        
        iframe {
            width: 100%;
            height: 100%;
            border: none;
            background: white;
        }
        
        .prompt-section {
            margin-top: 20px;
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .toggle-button {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            padding: 12px 20px;
            background-color: var(--secondary-color);
            color: white;
            border: none;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-size: 1rem;
            font-weight: 500;
            transition: var(--transition);
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        
        .toggle-button:hover {
            background-color: #2980b9;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }
        
        .export-button {
            background-color: var(--accent-color);
        }
        
        .export-button:hover {
            background-color: #c0392b;
        }
        
        .toggle-button i {
            font-size: 1rem;
            transition: var(--transition);
        }
        
        #promptContainer {
            display: none;
            background-color: white;
            padding: 25px;
            border: 1px solid #e1e4e8;
            margin-top: 20px;
            text-align: left;
            font-size: 0.95rem;
            white-space: pre-wrap;
            max-height: 500px;
            overflow-y: auto;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
        }
        
        #promptContainer h3 {
            color: var(--primary-color);
            border-bottom: 2px solid var(--secondary-color);
            padding-bottom: 10px;
            margin-bottom: 15px;
            font-size: 1.4rem;
        }
        
        #promptContainer p {
            margin-bottom: 15px;
            line-height: 1.6;
        }
        
        #promptContainer ul {
            padding-left: 20px;
            margin-bottom: 15px;
        }
        
        #promptContainer li {
            margin-bottom: 10px;
        }
        
        footer {
            text-align: center;
            padding: 20px;
            background: var(--primary-color);
            color: var(--light-text);
            font-size: 0.9rem;
            border-top: 3px solid var(--secondary-color);
        }
        
        @media (max-width: 768px) {
            .container {
                margin: 15px auto;
            }
            
            header {
                padding: 15px 20px;
            }
            
            header h1 {
                font-size: 1.8rem;
            }
            
            .iframe-container {
                height: 450px;
            }
            
            #promptContainer {
                padding: 20px;
            }
        }
        
        @media (max-width: 480px) {
            body {
                padding: 10px;
            }
            
            header h1 {
                font-size: 1.5rem;
            }
            
            header p {
                font-size: 0.95rem;
            }
            
            .iframe-container {
                height: 400px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Le Biographe - Assistant IA</h1>
            <p>L'assistant de la direction de la documentation de Radio France qui aide à la rédaction des biographies.</p>
        </header>
        
        <div class="chat-container">
            <!-- Intégration de l'assistant Copilot Studio -->
            <div class="iframe-container">
                <iframe src="https://web.powerva.microsoft.com/environments/Default-1d643b07-8cf5-4e2d-ad1e-86d6b948fc3b/bots/crff4_leBiographe/webchat?__version__=2"></iframe>
            </div>
            
            <!-- Section pour le prompt system -->
            <div class="prompt-section">
                <button class="toggle-button" onclick="togglePrompt()">
                    <i class="fas fa-book"></i> Afficher le prompt system
                </button>
                <button class="toggle-button export-button" onclick="exportConversation()">
                    <i class="fas fa-file-export"></i> Exporter discussion
                </button>
            </div>
            
            <div id="promptContainer">
                <h3>Prompt System (Lecture seule)</h3>
                <p>Tu vas rédiger une biographie sur la base exclusive des connaissances qui te sont communiquées.</p>
                <p>Voici quelques règles à respecter :</p>
                <ul>
                    <li>Construction classique d'une biographie, avec une construction en autant de paragraphes que nécessaires, en fonction de la durée de vie de la personne et de ses éléments biographiques. Mais il n'y a aucune contrainte absolue de forme.</li>
                    <li>Les intertitres, quand il y en a, sont là pour guider la lecture et correspondent aux grands jalons biographiques, avec un détail significatif et propre à la personne dont il est question, pour éviter les poncifs répétitifs du genre "Une enfance heureuse", "Une adolescence difficile", etc.</li>
                    <li>La nationalité doit être indiquée dans sa fonction (acteur français plutôt qu'acteur).</li>
                    <li>Préciser Dates et lieux de naissance / mort.</li>
                    <li>Dans la rédaction : Pas de parti pris, du factuel rien que du factuel.</li>
                    <li>Indiquer les grandes étapes de la carrière / vie, si possible en paragraphes avec des intertitres SEO compatibles.</li>
                    <li>Nul besoin d'être exhaustif.</li>
                    <li>Maillage interne et externe important avec des pages de taxonomie adaptées.</li>
                    <li>Pas de lien hypertexte vers un site officiel, ou un compte d'un réseau social.</li>
                    <li>Pas de rebond dans le texte.</li>
                    <li>À la fin de ta biographie : rédige un paragraphe intitulé "Sources" dans lequel tu indiques le nom des documents, leur date, le média, que tu as utilisé pour rédiger la bio. Présente ce paragraphe sous forme de bullet points.</li>
                </ul>
            </div>
        </div>
        
        <footer>
            &copy; 2025 Le Biographe - Un assistant IA pour la rédaction de biographies
        </footer>
    </div>

    <script>
        function togglePrompt() {
            var promptDiv = document.getElementById("promptContainer");
            var button = document.querySelector(".toggle-button:not(.export-button)");
            
            if (promptDiv.style.display === "none" || promptDiv.style.display === "") {
                promptDiv.style.display = "block";
                button.innerHTML = '<i class="fas fa-times"></i> Masquer le prompt system';
            } else {
                promptDiv.style.display = "none";
                button.innerHTML = '<i class="fas fa-book"></i> Afficher le prompt system';
            }
        }
        
        function exportConversation() {
            // Afficher un message de préparation
            const statusMsg = document.createElement('div');
            statusMsg.style.position = 'fixed';
            statusMsg.style.top = '20px';
            statusMsg.style.left = '50%';
            statusMsg.style.transform = 'translateX(-50%)';
            statusMsg.style.padding = '10px 20px';
            statusMsg.style.background = 'rgba(0,0,0,0.7)';
            statusMsg.style.color = 'white';
            statusMsg.style.borderRadius = '5px';
            statusMsg.style.zIndex = '9999';
            statusMsg.textContent = 'Préparation de l\'export PDF...';
            document.body.appendChild(statusMsg);
            
            // Utiliser setTimeout pour laisser le temps au message de s'afficher
            setTimeout(() => {
                try {
                    // Obtenir le contenu de l'iframe
                    const iframe = document.querySelector('iframe');
                    const iframeContent = iframe.contentDocument || iframe.contentWindow.document;
                    
                    // Cibler le conteneur de conversation dans l'iframe
                    // Note: Les sélecteurs exacts peuvent varier selon la structure du chat
                    const conversationContainer = iframeContent.querySelector('.webchat__basic-transcript');
                    
                    if (!conversationContainer) {
                        statusMsg.textContent = 'Impossible de trouver la conversation. Veuillez réessayer.';
                        setTimeout(() => {
                            document.body.removeChild(statusMsg);
                        }, 3000);
                        return;
                    }
                    
                    // Créer une copie du contenu pour ne pas perturber l'original
                    const contentClone = conversationContainer.cloneNode(true);
                    
                    // Créer un conteneur temporaire dans la page principale
                    const tempContainer = document.createElement('div');
                    tempContainer.style.position = 'absolute';
                    tempContainer.style.left = '-9999px';
                    tempContainer.style.top = '-9999px';
                    tempContainer.appendChild(contentClone);
                    document.body.appendChild(tempContainer);
                    
                    // Style pour le PDF
                    const style = document.createElement('style');
                    style.textContent = `
                        * { font-family: Arial, sans-serif; }
                        .message { margin-bottom: 15px; padding: 10px; border-radius: 5px; }
                        .user-message { background-color: #f1f0f0; text-align: right; }
                        .bot-message { background-color: #e3f2fd; }
                    `;
                    tempContainer.appendChild(style);
                    
                    // Obtenir la date pour le nom du fichier
                    const today = new Date();
                    const dateStr = today.toISOString().slice(0, 10);
                    
                    // Générer le PDF
                    html2canvas(tempContainer, { 
                        scale: 2,
                        logging: false,
                        useCORS: true
                    }).then(canvas => {
                        // Mettre à jour le message
                        statusMsg.textContent = 'Génération du PDF en cours...';
                        
                        const imgData = canvas.toDataURL('image/png');
                        const pdf = new jspdf.jsPDF({
                            orientation: 'portrait',
                            unit: 'mm',
                            format: 'a4'
                        });
                        
                        // Calculer les dimensions pour ajuster à la page A4
                        const imgWidth = 210; // A4 width in mm
                        const imgHeight = canvas.height * imgWidth / canvas.width;
                        
                        // Ajouter un titre
                        pdf.setFontSize(16);
                        pdf.text('Conversation avec Le Biographe', 105, 15, { align: 'center' });
                        pdf.setFontSize(12);
                        pdf.text(`Exporté le ${today.toLocaleDateString('fr-FR')}`, 105, 22, { align: 'center' });
                        
                        // Ajouter l'image de la conversation
                        pdf.addImage(imgData, 'PNG', 0, 30, imgWidth, imgHeight);
                        
                        // Télécharger le PDF
                        pdf.save(`Le_Biographe_Conversation_${dateStr}.pdf`);
                        
                        // Nettoyer
                        document.body.removeChild(tempContainer);
                        statusMsg.textContent = 'PDF téléchargé avec succès!';
                        setTimeout(() => {
                            document.body.removeChild(statusMsg);
                        }, 3000);
                    }).catch(err => {
                        console.error('Erreur lors de la génération du PDF:', err);
                        statusMsg.textContent = 'Erreur lors de la génération du PDF. Veuillez réessayer.';
                        setTimeout(() => {
                            document.body.removeChild(statusMsg);
                        }, 3000);
                        document.body.removeChild(tempContainer);
                    });
                } catch (error) {
                    console.error('Erreur:', error);
                    statusMsg.textContent = 'Erreur lors de l\'exportation. Veuillez réessayer.';
                    setTimeout(() => {
                        document.body.removeChild(statusMsg);
                    }, 3000);
                }
            }, 100);
        }
    </script>
</body>
</html>
